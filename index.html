<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Interactive ODE Solver — Mobile Optimized</title>
<script src="https://cdn.jsdelivr.net/npm/plotly.js-dist-min"></script>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 10px;
    padding: 0;
}

/* MOBILE-FRIENDLY SLIDERS */
.slider-container {
    margin-bottom: 18px;
    font-size: 16px;
}

input[type=range] {
    width: 100%;
    height: 28px;
}

/* GRAPH CONTAINERS */
.graph {
    width: 100%;
    height: 350px;
    margin-top: 25px;
}

/* LABELS & SELECT MENU */
label {
    font-weight: bold;
    font-size: 17px;
}

select {
    width: 100%;
    padding: 10px;
    font-size: 17px;
    margin-bottom: 15px;
    border-radius: 6px;
}

/* HEADERS */
h2 {
    text-align: center;
    font-size: 22px;
}

/* MOBILE VIEW TWEAKS */
@media (max-width: 600px) {
    h2 { font-size: 20px; }
    label { font-size: 16px; }
    .graph { height: 300px; }
}
</style>
</head>
<body>

<h2>Interactive ODE Systems</h2>

<!-- DROPDOWN MENU -->
<label>Select View:</label>
<select id="viewSelector" onchange="updateView()">
    <option value="all">Show All Graphs</option>
    <option value="system1">System 1 Only</option>
    <option value="system2">System 2 Only</option>
</select>

<!-- SLIDERS -->
<div id="sliders"></div>

<!-- SYSTEM 1 GRAPH GROUP -->
<div id="system1Group">
    <div id="plot1" class="graph"></div>
    <div id="plot3" class="graph"></div>
</div>

<!-- SYSTEM 2 GRAPH GROUP -->
<div id="system2Group">
    <div id="plot2" class="graph"></div>
    <div id="plot4" class="graph"></div>
</div>

<script>
// -----------------------------------------------------------
// PARAMETERS
// -----------------------------------------------------------
let params = {
    Ic:800, It:1000,
    Ra:0.95, Rb:0.97, Rh:0.8,
    Da:1, Db:2, Dh:15
};

// -----------------------------------------------------------
// SLIDER CREATION (PHONE-FRIENDLY)
// -----------------------------------------------------------
function createSlider(name, min, max, step, value){
    return `
    <div class='slider-container'>
        <label>${name}: <span id='val_${name}'>${value}</span></label>
        <input type="range" min="${min}" max="${max}" step="${step}" value="${value}"
            oninput="
                params.${name} = parseFloat(this.value);
                document.getElementById('val_${name}').innerText = this.value;
                solve();
            ">
    </div>`;
}

document.getElementById("sliders").innerHTML =
    createSlider("Ic",0,2000,50,params.Ic)+
    createSlider("It",0,2000,50,params.It)+
    createSlider("Ra",0,1,0.01,params.Ra)+
    createSlider("Rb",0,1,0.01,params.Rb)+
    createSlider("Rh",0,1,0.01,params.Rh)+
    createSlider("Da",0,5,0.1,params.Da)+
    createSlider("Db",0,5,0.1,params.Db)+
    createSlider("Dh",0,30,1,params.Dh);

// -----------------------------------------------------------
// RK4 SOLVER
// -----------------------------------------------------------
function rk4(f, y, t, h){
    let k1 = f(t, y);
    let k2 = f(t+h/2, y.map((yi,i)=>yi+h*k1[i]/2));
    let k3 = f(t+h/2, y.map((yi,i)=>yi+h*k2[i]/2));
    let k4 = f(t+h, y.map((yi,i)=>yi+h*k3[i]));
    return y.map((yi,i)=> yi + h*(k1[i]+2*k2[i]+2*k3[i]+k4[i])/6 );
}

// -----------------------------------------------------------
// SYSTEM 1 (constant human rate)
// -----------------------------------------------------------
function system1(t, z){
    let a=z[0], b=z[1], c=z[2];
    let {Ic,It,Ra,Rb,Rh,Da,Db,Dh} = params;

    let num = (a + b + c + Ic);
    let denom = t*(Da+Db+Dh) + It;

    return [
        (num/denom) * Ra * Da,
        (num/denom) * Rb * Db,
        Rh * Dh
    ];
}

// -----------------------------------------------------------
// SYSTEM 2 (full human model)
// -----------------------------------------------------------
function system2(t, z){
    let a=z[0], b=z[1], c=z[2];
    let {Ic,It,Ra,Rb,Rh,Da,Db,Dh} = params;

    let num = a + b + c + Ic;
    let denom = t*(Da+Db+Dh) + It;

    let dadt = (num/denom)*Ra*Da;
    let dbdt = (num/denom)*Rb*Db;

    let combo =
        ((num/denom)*Ra*Da + a) +
        ((num/denom)*Rb*Db + b);

    let dcdt = (combo / ((t+1)*(Da+Db))) * Dh;

    return [dadt, dbdt, dcdt];
}

// -----------------------------------------------------------
// MAIN SOLVE + PLOT
// -----------------------------------------------------------
function solve(){

    let t0=0, t1=100, steps=300;
    let h=(t1-t0)/steps;

    let tvals=[], a1=[], b1=[], c1=[];
    let a2=[], b2=[], c2=[];

    let y1=[0,0,0];
    let y2=[0,0,0];

    for(let i=0;i<=steps;i++){
        let t=t0+i*h;
        tvals.push(t);

        a1.push(y1[0]); b1.push(y1[1]); c1.push(y1[2]);
        a2.push(y2[0]); b2.push(y2[1]); c2.push(y2[2]);

        y1 = rk4(system1, y1, t, h);
        y2 = rk4(system2, y2, t, h);
    }

    Plotly.newPlot("plot1", [
        {x:tvals, y:a1, name:"AI1"},
        {x:tvals, y:b1, name:"AI2"},
        {x:tvals, y:c1, name:"Humans"}
    ], {title:"System 1 — ODE Solution"});

    Plotly.newPlot("plot2", [
        {x:tvals, y:a2, name:"AI1"},
        {x:tvals, y:b2, name:"AI2"},
        {x:tvals, y:c2, name:"Humans"}
    ], {title:"System 2 — ODE Solution"});

    // ERROR
    let tt=[], e1f=[], e1g=[], e1j=[], e2f=[], e2g=[], e2j=[];
    for(let i=1;i<tvals.length;i++){
        let t=tvals[i];

        let f_true=t*params.Da;
        let g_true=t*2;
        let j_true=t*15;

        e1f.push(100*(f_true - a1[i]) / f_true);
        e1g.push(100*(g_true - b1[i]) / g_true);
        e1j.push(100*(j_true - c1[i]) / j_true);

        e2f.push(100*(f_true - a2[i]) / f_true);
        e2g.push(100*(g_true - b2[i]) / g_true);
        e2j.push(100*(j_true - c2[i]) / j_true);

        tt.push(t);
    }

    Plotly.newPlot("plot3", [
        {x:tt, y:e1f, name:"AI1"},
        {x:tt, y:e1g, name:"AI2"},
        {x:tt, y:e1j, name:"Humans"}
    ], {title:"System 1 — % Error"});

    Plotly.newPlot("plot4", [
        {x:tt, y:e2f, name:"AI1"},
        {x:tt, y:e2g, name:"AI2"},
        {x:tt, y:e2j, name:"Humans"}
    ], {title:"System 2 — % Error"});
}

// -----------------------------------------------------------
// DROPDOWN VIEW CONTROL
// -----------------------------------------------------------
function updateView() {
    let v = document.getElementById("viewSelector").value;

    document.getElementById("system1Group").style.display =
        (v==="all" || v==="system1") ? "block" : "none";

    document.getElementById("system2Group").style.display =
        (v==="all" || v==="system2") ? "block" : "none";
}

solve();
updateView();

</script>
</body>
</html>
