<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Interactive ODE Solver — System 1 & System 2</title>
<script src="https://cdn.jsdelivr.net/npm/plotly.js-dist-min"></script>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 10px;
}

/* MOBILE-FRIENDLY SLIDERS */
.slider-container {
    margin-bottom: 18px;
    font-size: 16px;
}

input[type=range] {
    width: 100%;
    height: 28px;
}

/* GRAPH CONTAINERS */
.graph {
    width: 100%;
    height: 350px;
    margin-top: 30px;
}

/* LABELS & SELECT MENU */
label {
    font-weight: bold;
    font-size: 17px;
}

select {
    width: 100%;
    padding: 10px;
    font-size: 17px;
    margin-bottom: 18px;
    border-radius: 6px;
}

/* HEADERS */
h2 {
    text-align: center;
    font-size: 22px;
}

/* MOBILE OPTIMIZATION */
@media (max-width: 600px) {
    h2 { font-size: 20px; }
    label { font-size: 16px; }
    .graph { height: 300px; }
}
</style>
</head>
<body>

<h2>Interactive ODE Systems</h2>

<!-- DROPDOWN MENU -->
<label>Select View:</label>
<select id="viewSelector" onchange="updateView()">
    <option value="ode">ODE Solution</option>
    <option value="error">Percent Error</option>
    <option value="all">Show All</option>
</select>

<!-- SLIDER PANEL -->
<div id="sliders"></div>

<!-- ODE GRAPH GROUP -->
<div id="odeGroup">
    <div id="plot1" class="graph"></div>
    <div id="plot2" class="graph"></div>
</div>

<!-- ERROR GRAPH GROUP -->
<div id="errorGroup">
    <div id="plot3" class="graph"></div>
    <div id="plot4" class="graph"></div>
</div>

<script>
// -----------------------------------------------------------
// PARAMETERS
// -----------------------------------------------------------
let params = {
    Ic:800, It:1000,
    Ra:0.95, Rb:0.97, Rh:0.8,
    Da:1, Db:2, Dh:15
};

// -----------------------------------------------------------
// CREATE SLIDERS (PHONE FRIENDLY)
// -----------------------------------------------------------
function createSlider(name, min, max, step, value){
    return `
    <div class="slider-container">
        <label>${name}: <span id="val_${name}">${value}</span></label>
        <input type="range" min="${min}" max="${max}" step="${step}" value="${value}"
            oninput="
                params.${name}=parseFloat(this.value);
                document.getElementById('val_${name}').innerText=this.value;
                solve();
            ">
    </div>`;
}

document.getElementById("sliders").innerHTML =
    createSlider("Ic",0,2000,50,params.Ic)+
    createSlider("It",0,2000,50,params.It)+
    createSlider("Ra",0,1,0.01,params.Ra)+
    createSlider("Rb",0,1,0.01,params.Rb)+
    createSlider("Rh",0,1,0.01,params.Rh)+
    createSlider("Da",0,5,0.1,params.Da)+
    createSlider("Db",0,5,0.1,params.Db)+
    createSlider("Dh",0,30,1,params.Dh);

// -----------------------------------------------------------
// RK4 SOLVER
// -----------------------------------------------------------
function rk4(f, y, t, h){
    let k1 = f(t, y);
    let k2 = f(t+h/2, y.map((yi,i)=>yi+h*k1[i]/2));
    let k3 = f(t+h/2, y.map((yi,i)=>yi+h*k2[i]/2));
    let k4 = f(t+h, y.map((yi,i)=>yi+h*k3[i]));
    return y.map((yi,i)=> yi + h*(k1[i]+2*k2[i]+2*k3[i]+k4[i])/6 );
}

// -----------------------------------------------------------
// SYSTEM 1 (CONSTANT HUMAN RATE)
// -----------------------------------------------------------
function system1(t, z){
    let a=z[0], b=z[1], c=z[2];
    let {Ic,It,Ra,Rb,Rh,Da,Db,Dh} = params;

    let sum = a + b + c + Ic;
    let denom = t*(Da+Db+Dh) + It;

    return [
        (sum/denom)*Ra*Da,
        (sum/denom)*Rb*Db,
        Rh * Dh
    ];
}

// -----------------------------------------------------------
// SYSTEM 2 (FULL HUMAN GROWTH EQUATION)
// -----------------------------------------------------------
function system2(t, z){
    let a=z[0], b=z[1], c=z[2];
    let {Ic,It,Ra,Rb,Rh,Da,Db,Dh} = params;

    let sum = a+b+c+Ic;
    let denom = t*(Da+Db+Dh) + It;

    let dadt = (sum/denom)*Ra*Da;
    let dbdt = (sum/denom)*Rb*Db;

    let combo =
        ((sum/denom)*Ra*Da + a) +
        ((sum/denom)*Rb*Db + b);

    let dcdt = (combo / ((t+1)*(Da+Db))) * Dh;

    return [dadt, dbdt, dcdt];
}

// -----------------------------------------------------------
// MAIN SOLVER + PLOTS
// -----------------------------------------------------------
function solve(){

    let t0=0, t1=100, steps=300;
    let h=(t1-t0)/steps;

    let tvals=[], a1=[], b1=[], c1=[], a2=[], b2=[], c2=[];
    let y1=[0,0,0], y2=[0,0,0];

    for(let i=0;i<=steps;i++){
        let t = t0+i*h;

        tvals.push(t);
        a1.push(y1[0]); b1.push(y1[1]); c1.push(y1[2]);
        a2.push(y2[0]); b2.push(y2[1]); c2.push(y2[2]);

        y1 = rk4(system1, y1, t, h);
        y2 = rk4(system2, y2, t, h);
    }

    // -------------------------------------------------------
    // GRAPH 1 — SYSTEM 1 ODE
    // -------------------------------------------------------
    Plotly.newPlot("plot1", [
        {x:tvals, y:a1, name:"AI1"},
        {x:tvals, y:b1, name:"AI2"},
        {x:tvals, y:c1, name:"Humans"}
    ], {
        title:"ODE Solution — System 1 (Constant Human Rate)",
        xaxis:{title:"Time (t)"},
        yaxis:{title:"Value"}
    });

    // -------------------------------------------------------
    // GRAPH 2 — SYSTEM 2 ODE
    // -------------------------------------------------------
    Plotly.newPlot("plot2", [
        {x:tvals, y:a2, name:"AI1"},
        {x:tvals, y:b2, name:"AI2"},
        {x:tvals, y:c2, name:"Humans"}
    ], {
        title:"ODE Solution — System 2 (Full Growth Model)",
        xaxis:{title:"Time (t)"},
        yaxis:{title:"Value"}
    });

    // -------------------- ERROR CALCULATIONS --------------------
    let tt=[], e1a=[], e1b=[], e1c=[], e2a=[], e2b=[], e2c[];

    for(let i=1;i<tvals.length;i++){
        let t=tvals[i];
        let f_true=t*params.Da;
        let g_true=t*2;
        let j_true=t*15;

        e1a.push(100*(f_true - a1[i]) / f_true);
        e1b.push(100*(g_true - b1[i]) / g_true);
        e1c.push(100*(j_true - c1[i]) / j_true);

        e2a.push(100*(f_true - a2[i]) / f_true);
        e2b.push(100*(g_true - b2[i]) / g_true);
        e2c.push(100*(j_true - c2[i]) / j_true);

        tt.push(t);
    }

    // -------------------------------------------------------
    // GRAPH 3 — SYSTEM 1 PERCENT ERROR
    // -------------------------------------------------------
    Plotly.newPlot("plot3", [
        {x:tt, y:e1a, name:"AI1 Error %"},
        {x:tt, y:e1b, name:"AI2 Error %"},
        {x:tt, y:e1c, name:"Human Error %"}
    ], {
        title:"Percent Error — System 1",
        xaxis:{title:"Time (t)"},
        yaxis:{title:"% Incorrect"}
    });

    // -------------------------------------------------------
    // GRAPH 4 — SYSTEM 2 PERCENT ERROR
    // -------------------------------------------------------
    Plotly.newPlot("plot4", [
        {x:tt, y:e2a, name:"AI1 Error %"},
        {x:tt, y:e2b, name:"AI2 Error %"},
        {x:tt, y:e2c, name:"Human Error %"}
    ], {
        title:"Percent Error — System 2",
        xaxis:{title:"Time (t)"},
        yaxis:{title:"% Incorrect"}
    });
}

// -----------------------------------------------------------
// DROPDOWN LOGIC
// -----------------------------------------------------------
function updateView() {
    let v = document.getElementById("viewSelector").value;

    document.getElementById("odeGroup").style.display =
        (v==="ode" || v==="all") ? "block" : "none";

    document.getElementById("errorGroup").style.display =
        (v==="error" || v==="all") ? "block" : "none";
}

solve();
updateView();

</script>
</body>
</html>

