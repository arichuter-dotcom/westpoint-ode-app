<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Interactive ODE Solver</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
body { font-family: Arial; margin: 20px; }
.slider-container { margin-bottom: 15px; }
</style>
</head>
<body>

<h2>Interactive ODE System</h2>

<div id="sliders"></div>
<div id="plot1" style="width:100%;height:400px;"></div>
<div id="plot2" style="width:100%;height:400px;"></div>

<script>
// ---- PARAMETERS ----
let params = {
    Ic:1000, It:1000, Ra:0.95, Rb:0.97, Rh:0.8, Da:1, Db:2, Dh:15
};

// ---- CREATE SLIDERS ----
function createSlider(name, min, max, step, value){
    return `
    <div class='slider-container'>
        <label>${name}: <span id='val_${name}'>${value}</span></label><br>
        <input type="range" min="${min}" max="${max}" step="${step}" value="${value}"
            oninput="params.${name}=parseFloat(this.value); document.getElementById('val_${name}').innerText=this.value; solve();">
    </div>`;
}

document.getElementById("sliders").innerHTML =
    createSlider("Ic",0,2000,50,1000)+
    createSlider("It",0,2000,50,1000)+
    createSlider("Ra",0,1,0.01,0.95)+
    createSlider("Rb",0,1,0.01,0.97)+
    createSlider("Rh",0,1,0.01,0.8)+
    createSlider("Da",0,5,0.1,1)+
    createSlider("Db",0,5,0.1,2)+
    createSlider("Dh",0,30,1,15);

// ---- RK4 ODE Solver ----
function rk4(f, y, t, h){
    let k1 = f(t, y);
    let k2 = f(t+h/2, y.map((yi,i)=>yi+h*k1[i]/2));
    let k3 = f(t+h/2, y.map((yi,i)=>yi+h*k2[i]/2));
    let k4 = f(t+h, y.map((yi,i)=>yi+h*k3[i]));
    return y.map((yi,i)=>yi + h*(k1[i]+2*k2[i]+2*k3[i]+k4[i])/6);
}

// ---- ODE System ----
function system(t, z){
    let a=z[0], b=z[1], c=z[2];
    let {Ic,It,Ra,Rb,Rh,Da,Db,Dh}=params;

    let denom = (t)*(Da+Db+Dh)+It;
    let dadt = ((a+b+c+Ic)/denom)*(Ra)*(Da);
    let dbdt = ((a+b+c+Ic)/denom)*(Rb)*(Db);
    let dcdt = (((((a+b+c+Ic)/denom)*(Ra)*(Da)+a) + (((a+b+c+Ic)/denom)*(Rb)*(Db)+b)) / ((t+1)*(Da+Db)) * Dh);
    return [dadt, dbdt, dcdt];
}

// ---- MAIN SOLVE ----
function solve(){
    let t0=0, t1=100, steps=400;
    let h=(t1-t0)/steps;
    let tvals=[], a=[], b=[], c=[];
    let y=[0,0,0];

    for(let i=0;i<=steps;i++){
        let t=t0+i*h;
        tvals.push(t);
        a.push(y[0]); b.push(y[1]); c.push(y[2]);
        y = rk4(system, y, t, h);
    }

    Plotly.newPlot("plot1", [
        {x:tvals, y:a, name:"a(t)"},
        {x:tvals, y:b, name:"b(t)"},
        {x:tvals, y:c, name:"c(t)"}
    ], {title:"ODE Solution", xaxis:{title:"t"}, yaxis:{title:"value"}});

    let Da=params.Da, Db=params.Db, Dh=params.Dh;
    let tt=[], ea=[], eb=[], ec=[];
    for(let k=0;k<=steps;k++){
        let t=t0+k*h;
        tt.push(t);
        let i_val=t*Da, g_val=t*Db, h_val=t*Dh;
        ea.push(100*(i_val-a[k])/i_val);
        eb.push(100*(g_val-b[k])/g_val);
        ec.push(100*(h_val-c[k])/h_val);
    }

    Plotly.newPlot("plot2", [
        {x:tt, y:ea, name:"% error a"},
        {x:tt, y:eb, name:"% error b"},
        {x:tt, y:ec, name:"% error c"}
    ], {title:"% Relative Error", xaxis:{title:"t"}, yaxis:{title:"%"}});
}

solve();
</script>

</body>
</html>

