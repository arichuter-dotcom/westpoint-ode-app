<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Interactive ODE Solver — System 1 & System 2</title>
<script src="https://cdn.jsdelivr.net/npm/plotly.js-dist-min"></script>

<style>
body { font-family: Arial; margin: 20px; }
.slider-container { margin-bottom: 15px; }
.graph { width:100%; height:400px; margin-top:40px; }
</style>
</head>
<body>

<h2>Interactive ODE Systems (System 1 vs System 2)</h2>

<div id="sliders"></div>

<div id="plot1" class="graph"></div>
<div id="plot2" class="graph"></div>
<div id="plot3" class="graph"></div>
<div id="plot4" class="graph"></div>

<script>
// -----------------------------------------------------------
// PARAMETERS
// -----------------------------------------------------------
let params = {
    Ic:800, It:1000,
    Ra:0.95, Rb:0.97, Rh:0.8,
    Da:1, Db:2, Dh:15
};

// -----------------------------------------------------------
// SLIDER CREATION
// -----------------------------------------------------------
function createSlider(name, min, max, step, value){
    return `
    <div class='slider-container'>
        <label>${name}: <span id='val_${name}'>${value}</span></label><br>
        <input type="range" min="${min}" max="${max}" step="${step}" value="${value}"
            oninput="params.${name}=parseFloat(this.value);
                     document.getElementById('val_${name}').innerText=this.value;
                     solve();">
    </div>`;
}

document.getElementById("sliders").innerHTML =
    createSlider("Ic",0,2000,50,params.Ic)+
    createSlider("It",0,2000,50,params.It)+
    createSlider("Ra",0,1,0.01,params.Ra)+
    createSlider("Rb",0,1,0.01,params.Rb)+
    createSlider("Rh",0,1,0.01,params.Rh)+
    createSlider("Da",0,5,0.1,params.Da)+
    createSlider("Db",0,5,0.1,params.Db)+
    createSlider("Dh",0,30,1,params.Dh);

// -----------------------------------------------------------
// RK4 SOLVER
// -----------------------------------------------------------
function rk4(f, y, t, h){
    let k1 = f(t, y);
    let k2 = f(t+h/2, y.map((yi,i)=>yi+h*k1[i]/2));
    let k3 = f(t+h/2, y.map((yi,i)=>yi+h*k2[i]/2));
    let k4 = f(t+h, y.map((yi,i)=>yi+h*k3[i]));
    return y.map((yi,i)=> yi + h*(k1[i]+2*k2[i]+2*k3[i]+k4[i])/6 );
}

// -----------------------------------------------------------
// SYSTEM 1 (constant human growth)
// -----------------------------------------------------------
function system1(t, z){
    let a=z[0], b=z[1], c=z[2];
    let {Ic,It,Ra,Rb,Rh,Da,Db,Dh} = params;

    let num = (a + b + c + Ic);
    let denom = t*(Da+Db+Dh) + It;

    let dadt = (num/denom) * Ra * Da;
    let dbdt = (num/denom) * Rb * Db;
    let dcdt = Rh * Dh;   // <-- SYSTEM 1 FIXED HUMAN RATE

    return [dadt, dbdt, dcdt];
}

// -----------------------------------------------------------
// SYSTEM 2 (full human growth equation)
// -----------------------------------------------------------
function system2(t, z){
    let a=z[0], b=z[1], c=z[2];
    let {Ic,It,Ra,Rb,Rh,Da,Db,Dh} = params;

    let num = (a + b + c + Ic);
    let denom = t*(Da+Db+Dh) + It;

    let dadt = (num/denom)*Ra*Da;
    let dbdt = (num/denom)*Rb*Db;

    let combo =
        ((num/denom)*Ra*Da + a) +
        ((num/denom)*Rb*Db + b);

    let dcdt = (combo / ((t+1)*(Da+Db))) * Dh;   // <-- SYSTEM 2 HUMAN RATE

    return [dadt, dbdt, dcdt];
}

// -----------------------------------------------------------
// MAIN SOLVER FOR BOTH SYSTEMS
// -----------------------------------------------------------
function solve(){

    let t0=0, t1=100, steps=400;
    let h=(t1-t0)/steps;

    // arrays for system 1
    let tvals=[], a1=[], b1=[], c1=[];
    let y1=[0,0,0];

    // arrays for system 2
    let a2=[], b2=[], c2=[];
    let y2=[0,0,0];

    for(let i=0;i<=steps;i++){
        let t=t0+i*h;
        tvals.push(t);

        a1.push(y1[0]); b1.push(y1[1]); c1.push(y1[2]);
        a2.push(y2[0]); b2.push(y2[1]); c2.push(y2[2]);

        y1 = rk4(system1, y1, t, h);
        y2 = rk4(system2, y2, t, h);
    }

    // ---------------- GRAPH 1: System 1 ODE ----------------
    Plotly.newPlot("plot1", [
        {x:tvals, y:a1, name:"a(t) AI1"},
        {x:tvals, y:b1, name:"b(t) AI2"},
        {x:tvals, y:c1, name:"c(t) Humans (constant rate)"}
    ], {title:"System 1 ODE Solution", xaxis:{title:"t"}, yaxis:{title:"value"}});

    // ---------------- GRAPH 2: System 2 ODE ----------------
    Plotly.newPlot("plot2", [
        {x:tvals, y:a2, name:"a(t) AI1"},
        {x:tvals, y:b2, name:"b(t) AI2"},
        {x:tvals, y:c2, name:"c(t) Humans (full growth)"}
    ], {title:"System 2 ODE Solution", xaxis:{title:"t"}, yaxis:{title:"value"}});

    // ---------------- ERROR CALC FOR SYSTEM 1 ----------------
    let tt=[], e1a=[], e1b=[], e1c=[];
    for(let i=1;i<tvals.length;i++){
        let t=tvals[i];
        let f_true=t*params.Da;
        let g_true=t*2;
        let j_true=t*15;

        e1a.push(100*(f_true-a1[i])/f_true);
        e1b.push(100*(g_true-b1[i])/g_true);
        e1c.push(100*(j_true-c1[i])/j_true);

        tt.push(t);
    }

    Plotly.newPlot("plot3", [
        {x:tt, y:e1a, name:"% error AI1"},
        {x:tt, y:e1b, name:"% error AI2"},
        {x:tt, y:e1c, name:"% error Humans"}
    ], {title:"System 1 — Percent Error", xaxis:{title:"t"}, yaxis:{title:"%"}});

    // ---------------- ERROR CALC FOR SYSTEM 2 ----------------
    let e2a=[], e2b=[], e2c=[];
    for(let i=1;i<tvals.length;i++){
        let t=tvals[i];
        let f_true=t*params.Da;
        let g_true=t*2;
        let j_true=t*15;

        e2a.push(100*(f_true-a2[i])/f_true);
        e2b.push(100*(g_true-b2[i])/g_true);
        e2c.push(100*(j_true-c2[i])/j_true);
    }

    Plotly.newPlot("plot4", [
        {x:tt, y:e2a, name:"% error AI1"},
        {x:tt, y:e2b, name:"% error AI2"},
        {x:tt, y:e2c, name:"% error Humans"}
    ], {title:"System 2 — Percent Error", xaxis:{title:"t"}, yaxis:{title:"%"}});

}

solve();
</script>
</body>
</html>
